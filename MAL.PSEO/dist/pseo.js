var mal;(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{MonacoEditorCreator:()=>i,MonacoEditorOptimizer:()=>n,SourceHistoryForm:()=>s,Utils:()=>a,WebTemplateForm:()=>d});class n{static optimizeEditor(t){this.formContext=t.getFormContext(),this.sourceTab=this.formContext.ui.tabs.get("SourceCode"),this.moncaoEditorParentDocument=parent.document,this.setUpElementsAndCommandsAfterSectionDivRenders(this.createButtons())}static createButtons(){return[this.setUpCommitButton(),this.setUpThemeSwitcherButton(),this.setUpContractButton(),this.setUpExpandButton(),this.setUpSaveButton()]}static setUpElementsAndCommandsAfterSectionDivRenders(t){const e=setInterval((function(){const o=n.moncaoEditorParentDocument.querySelector('div[id^="tab-section"]');o&&(o.style.cssText="margin-top: -125px; padding-top: 125px",o.append(...t),"mal_sourcehistory"===n.formContext.data.entity.getEntityName()&&(o.removeChild(t[0]),o.removeChild(t[4])),n.toggleIcons(),n.sourceTab.addTabStateChange((()=>n.toggleIcons())),n.setUpEditorCommands(),clearInterval(e))}),100)}static setUpEditorCommands(){const t=setInterval((function(){n.monacoEditorIframe=n.moncaoEditorParentDocument.getElementById("WebResource_adx_source_ace")||n.moncaoEditorParentDocument.getElementById("WebResource_adx_registerstartupscript_editor"),n.monacoContainer=n.monacoEditorIframe&&n.monacoEditorIframe.contentDocument.getElementById("container"),n.monacoContainer&&(n.AddCommands(),clearInterval(t))}),100)}static toggleIcons(){"collapsed"===n.sourceTab.getDisplayState()?(this.moncaoEditorParentDocument.getElementById("spanExpandEditor").style.display="none",this.moncaoEditorParentDocument.getElementById("spanThemeSwitcher").style.display="none",this.moncaoEditorParentDocument.getElementById("spanSaveEditor")&&(this.moncaoEditorParentDocument.getElementById("spanSaveEditor").style.display="none"),this.moncaoEditorParentDocument.getElementById("spanCommitButton")&&(this.moncaoEditorParentDocument.getElementById("spanCommitButton").style.display="none")):"expanded"===n.sourceTab.getDisplayState()&&(this.moncaoEditorParentDocument.getElementById("spanExpandEditor").style.display="inline",this.moncaoEditorParentDocument.getElementById("spanThemeSwitcher").style.display="inline",this.moncaoEditorParentDocument.getElementById("spanSaveEditor")&&(this.moncaoEditorParentDocument.getElementById("spanSaveEditor").style.display="inline"),this.moncaoEditorParentDocument.getElementById("spanCommitButton")&&(this.moncaoEditorParentDocument.getElementById("spanCommitButton").style.display="inline"))}static AddCommands(){"expanded"===n.sourceTab.getDisplayState()&&[this.monacoContainer,this.moncaoEditorParentDocument].forEach((t=>t.addEventListener("keydown",(function(t){if(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)if("KeyS"===t.code)t.preventDefault(),n.moncaoEditorParentDocument.querySelector('[data-id="edit-form-save-btn"]').click();else if(t.shiftKey){if("KeyE"===t.code){t.preventDefault();const e=n.moncaoEditorParentDocument.getElementById("spanExpandEditor"),o=n.moncaoEditorParentDocument.getElementById("spanContractEditor");"inline"==e.style.display?e.click():"inline"==o.style.display&&o.click()}"KeyF"===t.code&&(t.preventDefault(),n.moncaoEditorParentDocument.getElementById("spanThemeSwitcher").click()),"KeyC"===t.code&&(t.preventDefault(),n.moncaoEditorParentDocument.getElementById("spanCommitButton").click())}}),!1)))}static addCustomHeader(){const t=document.createElement("div");t.textContent=this.moncaoEditorParentDocument.title.replace(" - Power Apps","").replace(": Information:",":").replace(": PSEO Form:",":"),t.id="customHeader",t.style.cssText="\n            height: 33px;\n            background-color: #fff;\n            position: absolute;\n            top: 0px;\n            left: 0px;\n            width: 100%;\n            padding: 5px 0 0 25px;\n            font-size: 18px;\n            color: #333;\n        ",n.monacoEditorIframe.parentElement.prepend(t)}static setHeaderColorsWhenExpandedOnDarkTheme(){this.moncaoEditorParentDocument.getElementById("spanThemeSwitcher").style.color="#ccc",this.moncaoEditorParentDocument.getElementById("spanContractEditor").style.color="#ccc",this.moncaoEditorParentDocument.getElementById("spanSaveEditor")&&(this.moncaoEditorParentDocument.getElementById("spanSaveEditor").style.color="#ccc"),this.moncaoEditorParentDocument.getElementById("spanCommitButtonSvg")&&this.moncaoEditorParentDocument.getElementById("spanCommitButtonSvg").setAttribute("fill","#ccc"),this.moncaoEditorParentDocument.getElementById("customHeader").style.backgroundColor="#000",this.moncaoEditorParentDocument.getElementById("customHeader").style.color="#aaa",n.monacoContainer.style.cssText="border: 0"}static setUpCommitButton(){const t=document.createElement("span");t.id="spanCommitButton",t.title="Commit (Ctrl + Shift + C)",t.style.cssText="\n        position: absolute; \n        right: 105px; \n        top: 7px; \n        font-size: 18px; \n        display: none; \n        z-index: 90000;\n        cursor: pointer;\n      ";const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.id="spanCommitButtonSvg",e.setAttribute("width","22"),e.setAttribute("height","22"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","#666"),e.setAttribute("style","margin-top: -2px");const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("fill-rule","evenodd"),o.setAttribute("d","M17.5 11.75a.75.75 0 01.75-.75h5a.75.75 0 010 1.5h-5a.75.75 0 01-.75-.75zm-17.5 0A.75.75 0 01.75 11h5a.75.75 0 010 1.5h-5a.75.75 0 01-.75-.75z");const i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("fill-rule","evenodd"),i.setAttribute("d","M12 16.25a4.5 4.5 0 100-9 4.5 4.5 0 000 9zm0 1.5a6 6 0 100-12 6 6 0 000 12z"),e.appendChild(o),e.appendChild(i),t.appendChild(e),t.addEventListener("click",(function(){n.moncaoEditorParentDocument.querySelectorAll('button[aria-label="Commit"]')[0].click()})),t}static setUpThemeSwitcherButton(){const t=document.createElement("span");return t.id="spanThemeSwitcher",t.title="Switch Theme (Ctrl + Shift + F)",t.classList.add("pa-ac","EditSeries-symbol","symbolFont"),t.style.cssText="\n        position: absolute; \n        right: 55px; \n        top: 7px; \n        font-size: 18px; \n        display: none; \n        z-index: 90000;\n        cursor: pointer;\n      ",t.addEventListener("click",(function(){const t=n.monacoEditorIframe.contentWindow.monaco;"dark"===n.currentTheme?("none"===n.moncaoEditorParentDocument.getElementById("spanExpandEditor").style.display&&(n.moncaoEditorParentDocument.getElementById("spanThemeSwitcher").style.color="#666",n.moncaoEditorParentDocument.getElementById("spanSaveEditor")&&(n.moncaoEditorParentDocument.getElementById("spanSaveEditor").style.color="#666"),n.moncaoEditorParentDocument.getElementById("spanContractEditor").style.color="#666",n.moncaoEditorParentDocument.getElementById("spanCommitButtonSvg")&&n.moncaoEditorParentDocument.getElementById("spanCommitButtonSvg").setAttribute("fill","#666"),n.moncaoEditorParentDocument.getElementById("customHeader").style.backgroundColor="#fff",n.moncaoEditorParentDocument.getElementById("customHeader").style.color="#333",n.monacoContainer.style.cssText="border: 1px solid #ddd"),t.editor.setTheme("vs-light"),n.currentTheme="light"):("none"===n.moncaoEditorParentDocument.getElementById("spanExpandEditor").style.display&&n.setHeaderColorsWhenExpandedOnDarkTheme(),t.editor.setTheme("vs-dark"),n.currentTheme="dark")})),t}static setUpContractButton(){const t=document.createElement("span");return t.id="spanContractEditor",t.title="Contract (Ctrl + Shift + E)",t.classList.add("pa-ac","MiniContract-symbol","symbolFont"),t.style.cssText="\n        position: absolute; \n        right: 30px; \n        top: 7px; \n        display: none; \n        font-size: 18px; \n        z-index: 90000;\n        cursor: pointer;\n      ",t.addEventListener("click",(function(){n.moncaoEditorParentDocument.querySelectorAll('div#mainContent,\n            [id^="tab-section"] div,\n            [data-id="form-footer"],\n            iframe#WebResource_adx_source_ace, \n            iframe#WebResource_adx_registerstartupscript_editor').forEach((t=>t.removeAttribute("style"))),n.monacoEditorIframe.contentDocument.getElementById("container").style.cssText="border: 1px solid #ddd",n.moncaoEditorParentDocument.getElementById("customHeader").remove(),n.moncaoEditorParentDocument.querySelector('div[id^="tab-section"]').style.cssText="margin-top: -125px; padding-top: 125px",this.style.display="none",this.style.color="#666",n.moncaoEditorParentDocument.getElementById("spanExpandEditor").style.display="inline",n.moncaoEditorParentDocument.getElementById("spanThemeSwitcher").style.color="#666",n.moncaoEditorParentDocument.getElementById("spanSaveEditor")&&(n.moncaoEditorParentDocument.getElementById("spanSaveEditor").style.color="#666"),n.moncaoEditorParentDocument.getElementById("spanCommitButtonSvg")&&n.moncaoEditorParentDocument.getElementById("spanCommitButtonSvg").setAttribute("fill","#666")})),t}static setUpExpandButton(){const t=document.createElement("span");return t.id="spanExpandEditor",t.title="Expand (Ctrl + Shift + E)",t.classList.add("pa-ac","ExpandButton-symbol","symbolFont"),t.style.cssText="\n            position: absolute; \n            right: 30px; \n            top: 7px; \n            display: none; \n            font-size: 18px; \n            z-index: 90000;\n            cursor: pointer;\n        ",t.addEventListener("click",(function(){n.moncaoEditorParentDocument.querySelector("div#mainContent").style.cssText="position: absolute; width: 100%; top: 0",n.moncaoEditorParentDocument.querySelector('[id^="tab-section"]').style.cssText="position: absolute; z-index: 90000; height: 100%; overflow: hidden",n.moncaoEditorParentDocument.querySelector('[id^="tab-section"] div').style.overflowY="hidden",n.moncaoEditorParentDocument.querySelector('[data-id="form-footer"]').style.display="none";const t=n.moncaoEditorParentDocument.getElementById("customHeader");t?t.style.display="inline":n.addCustomHeader(),n.monacoEditorIframe.style.cssText="\n          position: absolute; \n          top: 33px; \n          left: 0px; \n          height: calc(100% - 33px);\n        ",this.style.display="none",n.moncaoEditorParentDocument.getElementById("spanContractEditor").style.display="inline","dark"===n.currentTheme&&n.setHeaderColorsWhenExpandedOnDarkTheme()})),t}static setUpSaveButton(){const t=document.createElement("span");return t.id="spanSaveEditor",t.title="Save (Ctrl + S)",t.classList.add("pa-ac","Save-symbol","symbolFont"),t.style.cssText="\n            position: absolute; \n            right: 80px; \n            top: 7px; \n            display: none; \n            font-size: 18px; \n            z-index: 90000;\n            cursor: pointer;\n        ",t.addEventListener("click",(function(){n.moncaoEditorParentDocument.querySelector('[data-id="edit-form-save-btn"]').click()})),t}}n.currentTheme="light";var o=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{d(o.next(t))}catch(t){r(t)}}function s(t){try{d(o.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}d((o=o.apply(t,e||[])).next())}))};class i{static setUpEditor(t,e,n){return o(this,void 0,void 0,(function*(){if(this.editorLoaded)return;const o=new URL(window.document.location.href).searchParams,i=new URLSearchParams(decodeURIComponent(o.get("data"))),r=i.get("sourceField"),a=i.get("sourceTypeField"),s=a?t.getAttribute(a):null,d=t.getAttribute(r).getValue();if(this.registerLiquidLanguage(n),this.registerAutocompleteProvider(n),"mal_sourcehistory"===t.data.entity.getEntityName()){const o=yield this.createDiffEditor(t,e,n,d);this.handleEditorResize(o)}else{const e=this.createEditor(n,d,s);this.handleLanguageSwitch(s,n,e),this.handleEditorResize(e),this.handleSaving(t,r,e)}this.editorLoaded=!0}))}static createDiffEditor(t,e,n,i){var r;return o(this,void 0,void 0,(function*(){let o="",a="javascript",s="",d="adx_source";const l=t.getAttribute("mal_webtemplate").getValue()||t.getAttribute("mal_entityform").getValue()||t.getAttribute("mal_webformstep").getValue();"adx_webtemplate"!=l[0].entityType?(d="adx_registerstartupscript",s="?$select="+d):s="?$select="+d+",mal_sourcetype";const c=yield e.WebApi.retrieveRecord(l[0].entityType,l[0].id,s);o=c[d],"adx_webtemplate"===l[0].entityType&&(a=null!==(r=c["mal_sourcetype@OData.Community.Display.V1.FormattedValue"])&&void 0!==r?r:"liquid");const m=n.editor.createModel(i,a.toLocaleLowerCase()),u=n.editor.createModel(o,a.toLocaleLowerCase()),p=n.editor.createDiffEditor(document.getElementById("container"));return p.setModel({original:m,modified:u}),p.getModifiedEditor().updateOptions({readOnly:!0}),p}))}static handleSaving(t,e,n){t.data.entity.addOnSave((()=>t.getAttribute(e).setValue(n.getValue())))}static handleEditorResize(t){new ResizeObserver((()=>t.layout())).observe(document.getElementById("container"))}static createEditor(t,e,n){return t.editor.create(document.getElementById("container"),{value:e,language:n?n.getText()?n.getText().toLowerCase():"liquid":"javascript"})}static handleLanguageSwitch(t,e,n){null==t||t.addOnChange((function(){var o;const i=null!==(o=t.getText())&&void 0!==o?o:"liquid";e.editor.setModelLanguage(n.getModel(),i.toLowerCase())}))}static registerLiquidLanguage(t){t.languages.register({id:"liquid"}),t.languages.setLanguageConfiguration("liquid",{wordPattern:/(-?\d*\.\d\w*)|([^\`\~\!\@\$\^\&\*\(\)\=\+\[\{\]\}\\\|\;\:\'\"\,\.\<\>\/\s]+)/g,brackets:[["{{-","-}}"],["{{","}}"],["{%-","-%}"],["{%","%}"],["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{%-",close:"-%}"},{open:"{%",close:"%}"},{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"<",close:">"},{open:'"',close:'"'},{open:"'",close:"'"}]}),t.languages.setMonarchTokensProvider("liquid",{defaultToken:"",tokenPostfix:"",keywords:["assign","capture","endcapture","increment","decrement","if","else","elsif","endif","for","endfor","break","continue","limit","offset","range","reversed","cols","case","endcase","when","block","endblock","true","false","in","unless","endunless","cycle","tablerow","endtablerow","contains","startswith","endswith","comment","endcomment","raw","endraw","editable","endentitylist","endentityview","endinclude","endmarker","entitylist","entityview","forloop","image","include","marker","outputcache","plugin","style","text","widget","abs","append","at_least","at_most","capitalize","ceil","compact","concat","date","default","divided_by","downcase","escape","escape_once","first","floor","join","last","lstrip","map","minus","modulo","newline_to_br","plus","prepend","remove","remove_first","replace","replace_first","reverse","round","rstrip","size","slice","sort","sort_natural","split","strip","strip_html","strip_newlines","times","truncate","truncatewords","uniq","upcase","url_decode","url_encode"],operators:["==",">","<","<=",">=","!=","and","or"],symbols:/[~!@#%\^&*-+=|\\:`<>.?\/]+/,exponent:/[eE][\-+]?[0-9]+/,tokenizer:{root:[[/([a-zA-Z_\$][\w\$]*)(\s*)/,{cases:{"@default":"identifier"}}],[/<!--/,"comment.html","@comment"],[/\{\%\s*comment\s*\%\}/,"comment.html","@comment"],[/\{\{|\{\%/,{token:"@rematch",switchTo:"@liquidInSimpleState.root"}],[/(<)(\w+)(\/>)/,["delimiter.html","tag.html","delimiter.html"]],[/(<)(script)/,["delimiter.html",{token:"tag.html",next:"@script"}]],[/(<)(style)/,["delimiter.html",{token:"tag.html",next:"@style"}]],[/(<)([:\w]+)/,["delimiter.html",{token:"tag.html",next:"@liquidInHtmlAttribute"}]],[/(<\/)(\w+)/,["delimiter.html",{token:"tag.html",next:"@liquidInHtmlAttribute"}]],[/</,"delimiter.html"],[/\{/,"delimiter.html"],{include:"numbers"},[/[ \t\r\n]+/],[/[^<{]+/]],script:[[/\{\{\-?|\{\%\-?/,{token:"@rematch",switchTo:"@liquidInSimpleState.script"}],[/type/,"attribute.name","@scriptAfterType"],[/"([^"]*)"/,"attribute.value"],[/'([^']*)'/,"attribute.value"],[/[\w\-]+/,"attribute.name"],[/=/,"delimiter"],[/>/,{token:"delimiter.html",next:"@scriptEmbedded.text/javascript",nextEmbedded:"text/javascript"}],[/[ \t\r\n]+/],[/(<\/)(script\s*)(>)/,["delimiter.html","tag.html",{token:"delimiter.html",next:"@pop"}]]],scriptAfterType:[[/\{\{\-?|\{\%\-?/,{token:"@rematch",switchTo:"@liquidInSimpleState.scriptAfterType"}],[/=/,"delimiter","@scriptAfterTypeEquals"],[/>/,{token:"delimiter.html",next:"@scriptEmbedded.text/javascript",nextEmbedded:"text/javascript"}],[/[ \t\r\n]+/],[/<\/script\s*>/,{token:"@rematch",next:"@pop"}]],scriptAfterTypeEquals:[[/\{\{\-?|\{\%\-?/,{token:"@rematch",switchTo:"@liquidInSimpleState.scriptAfterTypeEquals"}],[/"([^"]*)"/,{token:"attribute.value",switchTo:"@scriptWithCustomType.$1"}],[/'([^']*)'/,{token:"attribute.value",switchTo:"@scriptWithCustomType.$1"}],[/>/,{token:"delimiter.html",next:"@scriptEmbedded.text/javascript",nextEmbedded:"text/javascript"}],[/[ \t\r\n]+/],[/<\/script\s*>/,{token:"@rematch",next:"@pop"}]],scriptWithCustomType:[[/\{\{\-?|\{\%\-?/,{token:"@rematch",switchTo:"@liquidInSimpleState.scriptWithCustomType.$S2"}],[/>/,{token:"delimiter.html",next:"@scriptEmbedded.$S2",nextEmbedded:"$S2"}],[/"([^"]*)"/,"attribute.value"],[/'([^']*)'/,"attribute.value"],[/[\w\-]+/,"attribute.name"],[/=/,"delimiter"],[/[ \t\r\n]+/],[/<\/script\s*>/,{token:"@rematch",next:"@pop"}]],scriptEmbedded:[[/\{\{\-?|\{\%\-?/,{token:"@rematch",switchTo:"@liquidInEmbeddedState.scriptEmbedded.$S2",nextEmbedded:"@pop"}],[/<\/script/,{token:"@rematch",next:"@pop",nextEmbedded:"@pop"}]],style:[[/\{\{\-?|\{\%\-?/,{token:"@rematch",switchTo:"@liquidInSimpleState.style"}],[/type/,"attribute.name","@styleAfterType"],[/"([^"]*)"/,"attribute.value"],[/'([^']*)'/,"attribute.value"],[/[\w\-]+/,"attribute.name"],[/=/,"delimiter"],[/>/,{token:"delimiter.html",next:"@styleEmbedded.text/css",nextEmbedded:"text/css"}],[/[ \t\r\n]+/],[/(<\/)(style\s*)(>)/,["delimiter.html","tag.html",{token:"delimiter.html",next:"@pop"}]]],styleAfterType:[[/\{\{\-?|\{\%\-?/,{token:"@rematch",switchTo:"@liquidInSimpleState.styleAfterType"}],[/=/,"delimiter","@styleAfterTypeEquals"],[/>/,{token:"delimiter.html",next:"@styleEmbedded.text/css",nextEmbedded:"text/css"}],[/[ \t\r\n]+/],[/<\/style\s*>/,{token:"@rematch",next:"@pop"}]],styleAfterTypeEquals:[[/\{\{\-?|\{\%\-?/,{token:"@rematch",switchTo:"@liquidInSimpleState.styleAfterTypeEquals"}],[/"([^"]*)"/,{token:"attribute.value",switchTo:"@styleWithCustomType.$1"}],[/'([^']*)'/,{token:"attribute.value",switchTo:"@styleWithCustomType.$1"}],[/>/,{token:"delimiter.html",next:"@styleEmbedded.text/css",nextEmbedded:"text/css"}],[/[ \t\r\n]+/],[/<\/style\s*>/,{token:"@rematch",next:"@pop"}]],styleWithCustomType:[[/\{\{\-?|\{\%\-?/,{token:"@rematch",switchTo:"@liquidInSimpleState.styleWithCustomType.$S2"}],[/>/,{token:"delimiter.html",next:"@styleEmbedded.$S2",nextEmbedded:"$S2"}],[/"([^"]*)"/,"attribute.value"],[/'([^']*)'/,"attribute.value"],[/[\w\-]+/,"attribute.name"],[/=/,"delimiter"],[/[ \t\r\n]+/],[/<\/style\s*>/,{token:"@rematch",next:"@pop"}]],styleEmbedded:[[/\{\{\-?|\{\%\-?/,{token:"@rematch",switchTo:"@liquidInEmbeddedState.styleEmbedded.$S2",nextEmbedded:"@pop"}],[/<\/style/,{token:"@rematch",next:"@pop",nextEmbedded:"@pop"}]],comment:[[/\{\%\s*endcomment\s*\%\}/,"comment.hmtl","@pop"],[/-->/,"comment.html","@pop"],[/\b(?!-->|endcomment\s*\%\}\b)\w+/,"comment.content.html"],[/./,"comment.content.html"]],liquidInHtmlAttribute:[[/"\{\{\-?|"\{\%\-?/,{token:"delimiter.liquid",next:"@liquidInHtmlAttributeEmbedded"}],[/\/?>/,"delimiter.html","@pop"],[/"([^"]*)"/,"attribute.value"],[/'([^']*)'/,"attribute.value"],[/[\w\-]+/,"attribute.name"],[/=/,"delimiter"],[/[ \t\r\n]+/]],liquidInHtmlAttributeEmbedded:[[/\'(.*)\'/],[/\-?\%\}"|\-?\}\}"/,"delimiter.liquid","@pop"],[/([a-zA-Z_\$][\w\$]*)/,{cases:{"@keywords":"keyword","@operators":"operator","@default":"variable.parameter.liquid"}}]],liquidInSimpleState:[[/\{\{\-?|\{\%\-?/,"delimiter.liquid"],[/\-?\}\}|\-?\%\}/,{token:"delimiter.liquid",switchTo:"@$S2.$S3"}],{include:"liquidRoot"}],liquidInEmbeddedState:[[/\{\{\-?|\{\%\-?/,"delimiter.liquid"],[/\-?\}\}|\-?\%\}/,{token:"delimiter.liquid",switchTo:"@$S2.$S3",nextEmbedded:"$S3"}],{include:"liquidRoot"}],liquidRoot:[[/\'(.*?)\'|\"(.*?)\"/],[/([a-zA-Z_\$][\w\$]*)/,{cases:{"@keywords":"keyword","@operators":"operator","@default":"variable.parameter.liquid"}}],{include:"numbers"},[/@symbols/,{cases:{"@operators":"operator","@default":""}}]],numbers:[[/\d+\.\d*(@exponent)?/,"number.float"],[/\.\d+(@exponent)?/,"number.float"],[/\d+@exponent/,"number.float"],[/\d+/,"number"],[/[;,.]/,"delimiter"]]}})}static registerAutocompleteProvider(t){t.languages.registerCompletionItemProvider("liquid",{provideCompletionItems:function(){const e=[],n=["assign","capture","endcapture","increment","decrement","if","else","elsif","endif","for","endfor","break","continue","limit","offset","range","reversed","cols","case","endcase","when","block","endblock","true","false","in","unless","endunless","cycle","tablerow","endtablerow","contains","startswith","endswith","comment","endcomment","raw","endraw","editable","endentitylist","endentityview","endinclude","endmarker","entitylist","entityview","forloop","image","include","marker","outputcache","plugin","style","text","widget","abs","append","at_least","at_most","capitalize","ceil","compact","concat","date","default","divided_by","downcase","escape","escape_once","first","floor","join","last","lstrip","map","minus","modulo","newline_to_br","plus","prepend","remove","remove_first","replace","replace_first","reverse","round","rstrip","size","slice","sort","sort_natural","split","strip","strip_html","strip_newlines","times","truncate","truncatewords","uniq","upcase","url_decode","url_encode"];for(let o=0;o<n.length;o++)e.push({label:n[o],kind:t.languages.CompletionItemKind.Keyword});return e}})}static getLanguageCode(){const t=parent.window.Xrm.Utility.getGlobalContext().userSettings.languageId,e={1026:"bg",1027:"ca",1029:"cs",1030:"da",1031:"de",1032:"el",1033:"",3082:"es",1061:"et",1069:"eu",1035:"fi",1036:"fr",1110:"gl",1081:"hi",1050:"hr",1038:"hu",1057:"id",1040:"it",1041:"ja",1087:"kk",1042:"ko",1063:"lt",1062:"lv",1086:"ms",1044:"nb",1043:"nl",1045:"pl",2070:"pt",1046:"pt-br",1048:"ro",1049:"ru",1051:"sk",1060:"sl",3098:"sr",2074:"sr-latn",1053:"sv",1054:"th",1055:"tr",1058:"uk",1066:"vi",2052:"zh-cn",3076:"zh-hk",1028:"zh-tw"};return t in e?e[t]:e[1033]}}i.editorLoaded=!1;var r=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{d(o.next(t))}catch(t){r(t)}}function s(t){try{d(o.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}d((o=o.apply(t,e||[])).next())}))};class a{static passContextToWebResource(t){return r(this,void 0,void 0,(function*(){const e=t.getFormContext(),n=e.getControl("WebResource_adx_source_ace")||e.getControl("WebResource_adx_registerstartupscript_editor"),o=yield n.getContentWindow(),i=setInterval((function(){"function"==typeof o.setClientApiContext&&(o.setClientApiContext(Xrm,e),clearInterval(i))}),100)}))}static commitSource(t,e,n){return r(this,void 0,void 0,(function*(){try{const o=t.getAttribute("adx_name").getValue(),i=(yield Xrm.Utility.getEntityMetadata(n)).DisplayName,r=t.getAttribute("adx_source")||t.getAttribute("adx_registerstartupscript");let a,s,d;switch(n){case"adx_entityform":s=`/adx_entityforms(${e.replace("{","").replace("}","")})`;break;case"adx_webformstep":a=`/adx_webformsteps(${e.replace("{","").replace("}","")})`;break;case"adx_webtemplate":d=`/adx_webtemplates(${e.replace("{","").replace("}","")})`}const l=window.prompt("Enter a message");if(l){const t={mal_name:`${i}: ${o} - ${(new Date).toLocaleString()}`,mal_source:r.getValue(),mal_message:l,"mal_WebFormStep@odata.bind":a,"mal_EntityForm@odata.bind":s,"mal_WebTemplate@odata.bind":d};Xrm.WebApi.createRecord("mal_sourcehistory",t).then((()=>{Xrm.Navigation.openAlertDialog({text:"Commit executed successfuly."},{width:330,height:126})}),(t=>{Xrm.Navigation.openAlertDialog({text:`Commit could not be created due to the following error: ${t}.`},{width:330,height:126})}))}else Xrm.Navigation.openAlertDialog({text:"You need to enter a message to be able to commit"},{width:330,height:126})}catch(t){Xrm.Navigation.openErrorDialog(t)}}))}}class s{static showRelevantSourceLookup(t){const e=t.getFormContext();e.getAttribute("mal_webtemplate").getValue()?e.getControl("mal_webtemplate").setVisible(!0):e.getAttribute("mal_entityform").getValue()?e.getControl("mal_entityform").setVisible(!0):e.getAttribute("mal_webformstep").getValue()&&e.getControl("mal_webformstep").setVisible(!0)}}class d{static switchToSourceIfSettingsAreSet(t){const e=t.getFormContext(),n=e.getAttribute("adx_name").getValue(),o=e.getAttribute("adx_websiteid").getValue();n&&o&&e.ui.tabs.get("SourceCode").setFocus()}static checkIfPCNInstalled(t){return e=this,n=void 0,i=function*(){const e=t.getFormContext();try{yield Xrm.WebApi.retrieveRecord("adx_sitesetting","19f848a3-2b6b-442d-9204-ccd00c0ad172","?$select=adx_name")}catch(t){e.getAttribute("mal_enabledforpcn").setRequiredLevel("none"),e.getControl("mal_enabledforpcn").setVisible(!1)}},new((o=void 0)||(o=Promise))((function(t,r){function a(t){try{d(i.next(t))}catch(t){r(t)}}function s(t){try{d(i.throw(t))}catch(t){r(t)}}function d(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(a,s)}d((i=i.apply(e,n||[])).next())}));var e,n,o,i}}(mal=void 0===mal?{}:mal).pseo=e})();